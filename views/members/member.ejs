<%- include('../partials/header.ejs') %>

<div class="row mt-5">
    <div class="col">
        <h2 class="mb-3"><%= user.full_name %></h2>

        <ul class="list-group">
            <li class="list-group-item">Total Secrets: <%= messages.length %> </li>
        </ul>

        <% if ( String(currentUser._id) === String(user._id)) { %>
        <div class="mt-3 mb-3">
            <a class="btn btn-primary mr-2" href="#">Request Admin Permissions</a>
            <a class="btn btn-primary" href="#">Edit Profile</a>
        </div>
        <% } %>

        <hr>
        <h2 class="mt-4 mb-4">Messages</h2>

        <% if ( String(currentUser._id) === String(user._id)) { %>
        <div class="text-center">
            <a class="btn btn-primary" href="/messages/add">Add Secret</a>
        </div>
        <% } %>
        <% if(messages.length) { %>
        <div class="card-columns mt-3">

            <% messages.forEach(message => { %>
            <div class="card text-white text-center p-3">
                <blockquote class="blockquote mb-0">
                    <h4 class="card-title"><%= message.title %> </h4>

                    <p><%= message.message %></p>

                    <% if (currentUser && currentUser.status === 'member') { %>
                    <footer class="blockquote-footer">
                        <small>
                            <%= message.postedBy.first_name + ' ' + message.postedBy.last_name %> -
                            <%= message.dateFormatted %>
                        </small>
                    </footer>
                    <% } %>


                    <div class="mt-3">
                        <a class="btn btn-primary btn-sm mr-2" href="/messages/<%= message._id  %>">View</a>
                        <% if (currentUser && currentUser.admin === true) { %>
                        <a class="btn btn-warning btn-sm" href="/messages/<%= message._id  %>/delete">Delete</a>
                        <% } %>
                    </div>

                </blockquote>
            </div>
            <% }) %>

        </div>
        <% } else { %>
        <h3>No messages yet</h3>
        <p><a href="/log-in">Login</a> and add a message or <a href="/sign-up">Sign Up</a></p>
        <% } %>

    </div>
</div>


<%- include('../partials/footer.ejs') %>