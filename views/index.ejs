<%- include('partials/header.ejs') %>

<div class="row pt-5">
    <div class="col">
        <h2>Welcome to the secret club <%= currentUser ? currentUser.username : '' %> </h2>

        <% if (!currentUser) { %>
        <p class="lead">Please <a href="/log-in">Login</a> or <a href="/sign-up">Sign up</a></p>
        <% } %>

        <% if (currentUser && !currentUser.status) { %>
        <div class="alert alert-secondary">
            You are not yet a member, <a href="/join">Join the Secret Club</a>
        </div>
        <% } else if(currentUser && currentUser.status) { %>
        <div class="mt-3">
            <a href="/messages/add" class="btn btn-primary">Add a secret</a>
        </div>
        <% } %>
    </div>
</div>
<div class="row">
    <div class="col">
        <h1>Messages</h1>
        <% if (messages.length) { %>

        <div class="card-columns">

            <% messages.forEach(message => { %>
            <div class="card text-white text-center p-3">
                <blockquote class="blockquote mb-0">
                    <h4 class="card-title"><%= message.title %> </h4>

                    <p><%= message.message %></p>

                    <% if (currentUser && currentUser.status === 'member') { %>
                    <footer class="blockquote-footer">
                        <small>
                            <%= message.postedBy.first_name + ' ' + message.postedBy.last_name %> - <%= message.date %>
                        </small>
                    </footer>
                    <% } %>
                </blockquote>
            </div>
            <% }) %>

        </div>
        <% } else { %>
        <h3>No messages yet</h3>
        <p><a href="/log-in">Login</a> and add a message or <a href="/sign-up">Sign Up</a></p>
        <% } %>

    </div>
</div>


<%- include('partials/footer.ejs') %>